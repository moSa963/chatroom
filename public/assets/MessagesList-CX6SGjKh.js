import{a as P,g as U,a8 as z,z as d,s as O,T as h,c as I,m as N,b as Y,r as b,u as g,j as o,d as q,e as Q,a9 as $,L as W,f as v,R as s,l as X,Q as G,aa as J,ab as j,B as c,S as M,A as Z,_ as K,ac as tt,ad as rt,h as D,i as et,ae as ot}from"./index-CaIhHF-A.js";import{p as nt}from"./Permissions-C4dgcXcN.js";import{A as it}from"./Avatar-uHaAvRsy.js";import{I as B}from"./IconButton-MJ3-UbfV.js";import{L as F}from"./LinearProgress-Jpiw1qIK.js";import{B as T}from"./Box-9rK6eZ5T.js";import{u as st}from"./useTheme-3LnXaT5y.js";import{C as lt}from"./CircularProgress-fLPsJ67Q.js";function at(t){return U("MuiLink",t)}const ct=P("MuiLink",["root","underlineNone","underlineHover","underlineAlways","button","focusVisible"]),dt=({theme:t,ownerState:r})=>{const e=r.color,i=z(t,`palette.${e}`,!1)||r.color,n=z(t,`palette.${e}Channel`);return"vars"in t&&n?`rgba(${n} / 0.4)`:d(i,.4)},R={primary:!0,secondary:!0,error:!0,info:!0,success:!0,warning:!0,textPrimary:!0,textSecondary:!0,textDisabled:!0},ut=t=>{const{classes:r,component:e,focusVisible:i,underline:n}=t,l={root:["root",`underline${I(n)}`,e==="button"&&"button",i&&"focusVisible"]};return Q(l,at,r)},pt=O(h,{name:"MuiLink",slot:"Root",overridesResolver:(t,r)=>{const{ownerState:e}=t;return[r.root,r[`underline${I(e.underline)}`],e.component==="button"&&r.button]}})(N(({theme:t})=>({variants:[{props:{underline:"none"},style:{textDecoration:"none"}},{props:{underline:"hover"},style:{textDecoration:"none","&:hover":{textDecoration:"underline"}}},{props:{underline:"always"},style:{textDecoration:"underline","&:hover":{textDecorationColor:"inherit"}}},{props:({underline:r,ownerState:e})=>r==="always"&&e.color!=="inherit",style:{textDecorationColor:"var(--Link-underlineColor)"}},...Object.entries(t.palette).filter(Y()).map(([r])=>({props:{underline:"always",color:r},style:{"--Link-underlineColor":t.vars?`rgba(${t.vars.palette[r].mainChannel} / 0.4)`:d(t.palette[r].main,.4)}})),{props:{underline:"always",color:"textPrimary"},style:{"--Link-underlineColor":t.vars?`rgba(${t.vars.palette.text.primaryChannel} / 0.4)`:d(t.palette.text.primary,.4)}},{props:{underline:"always",color:"textSecondary"},style:{"--Link-underlineColor":t.vars?`rgba(${t.vars.palette.text.secondaryChannel} / 0.4)`:d(t.palette.text.secondary,.4)}},{props:{underline:"always",color:"textDisabled"},style:{"--Link-underlineColor":(t.vars||t).palette.text.disabled}},{props:{component:"button"},style:{position:"relative",WebkitTapHighlightColor:"transparent",backgroundColor:"transparent",outline:0,border:0,margin:0,borderRadius:0,padding:0,cursor:"pointer",userSelect:"none",verticalAlign:"middle",MozAppearance:"none",WebkitAppearance:"none","&::-moz-focus-inner":{borderStyle:"none"},[`&.${ct.focusVisible}`]:{outline:"auto"}}}]}))),xt=b.forwardRef(function(r,e){const i=g({props:r,name:"MuiLink"}),n=st(),{className:l,color:a="primary",component:u="a",onBlur:p,onFocus:f,TypographyClasses:x,underline:C="always",variant:S="inherit",sx:y,...A}=i,[E,L]=b.useState(!1),_=w=>{$(w.target)||L(!1),p&&p(w)},H=w=>{$(w.target)&&L(!0),f&&f(w)},k={...i,color:a,component:u,focusVisible:E,underline:C,variant:S},V=ut(k);return o.jsx(pt,{color:a,className:q(V.root,l),classes:x,component:u,onBlur:_,onFocus:H,ref:e,ownerState:k,variant:S,...A,sx:[...R[a]===void 0?[{color:a}]:[],...Array.isArray(y)?y:[y]],style:{...A.style,...C==="always"&&a!=="inherit"&&!R[a]&&{"--Link-underlineColor":dt({theme:n,ownerState:k})}}})}),ht=({to:t,width:r=40,height:e=40,src:i})=>o.jsx(W,{to:t,children:o.jsx(it,{sx:{width:r,height:e,":hover":{border:"1px solid",borderColor:"primary.dark",transform:"scale(1.1)",filter:"brightness(95%)"}},src:i})}),wt=v(o.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 15h-2v-2h2zm0-4h-2V7h2z"}),"Error"),ft=v(o.jsx("path",{d:"M14.59 8 12 10.59 9.41 8 8 9.41 10.59 12 8 14.59 9.41 16 12 13.41 14.59 16 16 14.59 13.41 12 16 9.41zM12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2m0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8"}),"HighlightOff"),bt=({message:t})=>{const[r,e]=s.useState(!1),i=X(),n=()=>{r||jt(t,e,i)};return o.jsx(B,{size:"small",onClick:n,title:"delete",children:o.jsx(ft,{})})},jt=async(t,r,e)=>{r(!0),(await G(`api/rooms/${t==null?void 0:t.room_id}/messages/${t==null?void 0:t.id}`,"DELETE")).ok&&e(J({message:t,update:{deleted:!0,title:"deleted message"}})),r(!1)},yt=j(W)({}),kt=({children:t,to:r,variant:e})=>o.jsx(yt,{to:r,sx:{":hover":{color:"primary.dark"}},children:t}),mt=({message:t,right:r,children:e,manageMessage:i})=>{var n,l,a;return o.jsx(c,{sx:{position:"relative",width:"100%",py:1,display:"flex",justifyContent:r?"end":"start"},children:o.jsxs(M,{direction:r?"row-reverse":"row",spacing:1,sx:{maxWidth:{xs:"95%",md:"85%"}},children:[o.jsxs(M,{spacing:1,sx:{alignItems:"center"},children:[o.jsx(ht,{to:`/dashboard/rooms/${t==null?void 0:t.room_id}/users/${(n=t==null?void 0:t.user)==null?void 0:n.username}`,src:`${Z}api/users/${(l=t==null?void 0:t.user)==null?void 0:l.username}/image`}),i&&!(t!=null&&t.deleted)&&!(t!=null&&t.progress)&&o.jsx(bt,{message:t}),(t==null?void 0:t.error)&&o.jsx(K,{children:o.jsx(wt,{color:"error"})})]}),o.jsxs(c,{sx:{overflow:"hidden",maxWidth:"100%",minWidth:"10%"},children:[o.jsx(c,{sx:{display:"flex",justifyContent:r?"end":"start"},children:o.jsxs(h,{variant:"caption",noWrap:!0,children:[o.jsx(kt,{to:`/dashboard/users/${(a=t==null?void 0:t.user)==null?void 0:a.username}`,children:t==null?void 0:t.user.username}),".",new Date(t==null?void 0:t.created_at).toLocaleTimeString()]})}),o.jsxs(c,{sx:{display:"flex",flexDirection:"column",p:.5},children:[(t==null?void 0:t.progress)&&o.jsx(F,{variant:"determinate",value:t.progress}),t!=null&&t.deleted?o.jsx(h,{color:"error",children:"deleted message"}):e]})]})]})})},vt=({flip:t,children:r,scroll:e,onVisibleChange:i})=>{const n=s.useRef(null);return s.useEffect(()=>{if(e&&n.current){var l=n.current.getBoundingClientRect();i&&i(l.bottom>=e.top&&l.top<=e.bottom)}},[e,n,i]),o.jsx(T,{sx:{direction:t?"rtl":"ltr",alignSelf:t?"end":"start",resize:"horizontal",overflow:"hidden",userSelect:"none",width:250,maxWidth:"100%",minWidth:50},ref:n,children:r})},Ct=({title:t,right:r})=>{const[e,i]=s.useState(!0);return o.jsx(c,{onClick:()=>i(!1),sx:{position:"relative",border:"1px solid",bgcolor:n=>d(n.palette.background.default,.8),borderColor:n=>r?d(n.palette.primary.dark,.3):d(n.palette.divider,.3),p:.5},children:o.jsx(h,{sx:{wordBreak:"break-word",fontSize:{xs:"0.8rem",sm:"1rem"},overflow:"hidden",display:e?"-webkit-box":"block",WebkitBoxOrient:"vertical",WebkitLineClamp:"15"},children:St(t)})})},St=(t="")=>{const r=/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/g,e=t.split(" ");return e.forEach((i,n)=>{r.test(i)?e[n]=o.jsx(xt,{href:e[n],children:i},n):e[n]+=" "}),e},At=tt("img")({width:"100%",height:"100%",objectFit:"contain",overflow:"hidden"}),Lt=({src:t})=>o.jsx(s.Fragment,{children:t&&o.jsx(At,{src:t})}),zt=({src:t,type:r,paused:e=!1,onPlay:i})=>{const n=s.useRef(null);return s.useEffect(()=>{e&&(n!=null&&n.current)&&n.current.pause()},[e]),o.jsx(c,{sx:{width:"100%",objectFit:"contain",overflow:"hidden"},children:o.jsxs("video",{width:"100%",controls:!0,preload:"metadata",ref:n,onPlay:i,children:[t&&o.jsx("source",{src:t,type:r}),"Your browser does not support the video tag."]})})},$t=j("audio")({width:"100%"}),Mt=({src:t,type:r,paused:e,onPlay:i})=>{const n=s.useRef();return s.useEffect(()=>{e&&n.current&&n.current.pause()},[e]),o.jsx(T,{sx:{width:"100%"},children:o.jsxs($t,{controls:!0,sx:{padding:"10px"},preload:"metadata",ref:n,onPlay:i,children:[t&&o.jsx("source",{src:t,type:r}),"Your browser does not support the audio element."]})})},Dt=v(o.jsx("path",{d:"m20.41 8.41-4.83-4.83c-.37-.37-.88-.58-1.41-.58H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V9.83c0-.53-.21-1.04-.59-1.42M7 7h7v2H7zm10 10H7v-2h10zm0-4H7v-2h10z"}),"TextSnippet"),Rt=({src:t,name:r})=>o.jsxs(c,{sx:{display:"flex",flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"center",bgcolor:e=>d(e.palette.primary.dark,.2),borderRadius:5,aspectRatio:"3/2",maxWidth:300},children:[o.jsx("a",{target:"_blank",rel:"noreferrer",href:t,children:o.jsx(B,{sx:{width:50,height:50},children:o.jsx(Dt,{sx:{width:50,height:50}})})}),o.jsx(c,{sx:{textAlign:"center"},children:o.jsx(h,{sx:{wordBreak:"break-word"},children:r})})]}),It=({src:t,name:r,type:e,paused:i})=>e.startsWith("image")?o.jsx(Lt,{src:t}):e.startsWith("video")?o.jsx(zt,{src:t,type:e,paused:i}):e.startsWith("audio")?o.jsx(Mt,{src:t,type:e,paused:i}):o.jsx(Rt,{name:r,src:t}),Wt=j("iframe")({width:"100%",height:"100%",border:0}),Zt=({src:t})=>{const r=s.useMemo(()=>t&&Bt(t),[t]),{mode:e}=rt();return r?o.jsx(c,{sx:{width:"100%",overflow:"hidden",aspectRatio:"1.21",maxWidth:640},children:o.jsx(Wt,{src:`https://www.redditmedia.com/r/${r==null?void 0:r.at(0)}/comments/${r==null?void 0:r.at(1)}/${r==null?void 0:r.at(3)}/?ref_source=embed&amp;ref=share&amp;embed=true${e!=="light"&&"&amp;theme=dark"}`,sandbox:"allow-scripts allow-same-origin allow-popups"})}):o.jsx(b.Fragment,{})},Bt=t=>{const r=/^.*(reddit.com\/r)\/([^#&?/]+)\/(comments)\/([^#&?/]+)\/([^#&?/]+).*/,e=t.match(r);return e?[e[2],e[4],e[5]]:null},Ft=j("iframe")({width:"100%",height:"100%",border:0}),Tt=({src:t})=>{const r=s.useMemo(()=>t&&Et(t),[t]);return r?o.jsx(c,{sx:{width:"100%",overflow:"hidden",aspectRatio:"16/9"},children:o.jsx(Ft,{src:`https://www.youtube-nocookie.com/embed/${r}`})}):o.jsx(b.Fragment,{})},Et=t=>{const r=/^.*(youtu.be\/|v\/|u\/\w\/|embed\/|watch\?v=|&v=)([^#&?]*).*/,e=t.match(r);return e&&e[2].length===11?e[2]:null},_t=({title:t})=>{const r=s.useMemo(()=>Ht(t),[t]);for(var e=0;e<r.length;++e)for(var i=0;i<m.length;++i)if(r[e].match(m[i].rge))return m[i].component(r[e]);return o.jsx(s.Fragment,{})},Ht=t=>{const r=/(https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|www\.[a-zA-Z0-9][a-zA-Z0-9-]+[a-zA-Z0-9]\.[^\s]{2,}|https?:\/\/(?:www\.|(?!www))[a-zA-Z0-9]+\.[^\s]{2,}|www\.[a-zA-Z0-9]+\.[^\s]{2,})/g;return t.match(r)||[]},m=[{rge:/^((?:https?:)?\/\/)?((?:www|m)\.)?((?:youtube(-nocookie)?\.com|youtu.be))(\/(?:[\w-]+\?v=|embed\/|v\/)?)([\w-]+)(\S+)?$/,component:t=>o.jsx(Tt,{src:t})},{rge:/^.*(reddit.com\/r)\/([^#&?/]+)\/(comments)\/([^#&?/]+)\/([^#&?/]+).*/,component:t=>o.jsx(Zt,{src:t})}],Vt=({message:t,right:r,scroll:e,manageMessage:i})=>{const[n,l]=s.useState(!1);return o.jsxs(mt,{message:t,right:r,manageMessage:i,children:[(t==null?void 0:t.title)!==""&&o.jsx(Ct,{title:t==null?void 0:t.title,right:r}),o.jsxs(vt,{flip:r,scroll:e,onVisibleChange:l,children:[(t==null?void 0:t.src)&&o.jsx(It,{name:t==null?void 0:t.name,paused:!n,src:t.src.startsWith("api")?Z+t.src:t.src,type:t.mime_type}),!(t!=null&&t.src)&&o.jsx(_t,{title:t==null?void 0:t.title})]})]})},Pt=({date:t})=>o.jsx(c,{sx:{px:1,borderRadius:9999,bgcolor:r=>d(r.palette.primary.dark,.6)},children:o.jsx(h,{variant:"caption",children:t})}),Jt=({messages:t,loadMessages:r,room:e})=>{const i=D(et),[n,l]=s.useState(null),[a,u]=s.useState(null),p=D(ot),f=({currentTarget:x})=>{x.scrollHeight+x.scrollTop<=x.offsetHeight+1&&r(),!a&&u(setTimeout(()=>{l(x.getBoundingClientRect()),u(null)},2e3))};return o.jsxs(c,{"aria-label":"message list box",sx:{position:"relative",flex:1,alignItems:"center",height:"100%",display:"flex",overflow:"auto",overflowX:"hidden",p:1,flexDirection:"column-reverse","::-webkit-scrollbar":{display:"none"},scrollbarWidth:"none"},onScroll:f,children:[!t&&o.jsx(F,{color:"primary",sx:{width:1}}),t&&Ut(t,i,n,e),p&&o.jsx(lt,{sx:{alignSelf:"center"}})]})},Ut=(t,r,e,i)=>t.map((n,l)=>{var p;const a=l<=t.length-1?new Date((p=t[l+1])==null?void 0:p.created_at).toLocaleDateString():"",u=new Date(n==null?void 0:n.created_at).toLocaleDateString();return o.jsxs(s.Fragment,{children:[o.jsx(Vt,{message:n,right:(r==null?void 0:r.id)===(n==null?void 0:n.user_id),scroll:e,manageMessage:nt.manage_messages(i,r)}),a!==u&&o.jsx(Pt,{date:u})]},n==null?void 0:n.id)});export{ht as A,Jt as M,It as a};
