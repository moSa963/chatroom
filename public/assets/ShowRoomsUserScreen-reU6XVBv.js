import{f as U,j as r,a as D,g as O,s as M,X as te,c as h,m as E,z as V,b as W,r as f,u as N,d as R,e as A,T as b,A as ae,t as Q,R as p,B as m,Q as j,D as ne,G as ie,h as _,H as le,i as ce,E as de}from"./index-CaIhHF-A.js";import{R as pe}from"./RoomHeader-Di1Ec7-4.js";import{A as me,M as xe}from"./MessagesList-CX6SGjKh.js";import{u as ue,P as X}from"./useSlot-B2ypxoMr.js";import{S as fe}from"./Stack-CM_YU3QJ.js";import{B as he}from"./Box-9rK6eZ5T.js";import{D as J}from"./Divider-CHuyDDgv.js";import{u as Y,f as Z}from"./useFormControl-D2no1hWV.js";import{S as be}from"./SwitchBase-UZGig7WO.js";import{S as ge}from"./Screen-Boa_ILVN.js";import{p as I}from"./Permissions-C4dgcXcN.js";import{L as je}from"./LinearProgress-Jpiw1qIK.js";import"./Avatar-uHaAvRsy.js";import"./IconButton-MJ3-UbfV.js";import"./useTheme-3LnXaT5y.js";import"./CircularProgress-fLPsJ67Q.js";import"./dividerClasses-DWQ-FdG8.js";import"./useControlled-ND4_ps6i.js";const Ce=U(r.jsx("path",{d:"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2z"}),"CheckBoxOutlineBlank"),we=U(r.jsx("path",{d:"M19 3H5c-1.11 0-2 .9-2 2v14c0 1.1.89 2 2 2h14c1.11 0 2-.9 2-2V5c0-1.1-.89-2-2-2zm-9 14l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"}),"CheckBox"),ve=U(r.jsx("path",{d:"M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-2 10H7v-2h10v2z"}),"IndeterminateCheckBox");function ke(e){return O("MuiCheckbox",e)}const T=D("MuiCheckbox",["root","checked","disabled","indeterminate","colorPrimary","colorSecondary","sizeSmall","sizeMedium"]),ye=e=>{const{classes:s,indeterminate:o,color:a,size:n}=e,t={root:["root",o&&"indeterminate",`color${h(a)}`,`size${h(n)}`]},l=A(t,ke,s);return{...s,...l}},Se=M(be,{shouldForwardProp:e=>te(e)||e==="classes",name:"MuiCheckbox",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:o}=e;return[s.root,o.indeterminate&&s.indeterminate,s[`size${h(o.size)}`],o.color!=="default"&&s[`color${h(o.color)}`]]}})(E(({theme:e})=>({color:(e.vars||e).palette.text.secondary,variants:[{props:{color:"default",disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:V(e.palette.action.active,e.palette.action.hoverOpacity)}}},...Object.entries(e.palette).filter(W()).map(([s])=>({props:{color:s,disableRipple:!1},style:{"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[s].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:V(e.palette[s].main,e.palette.action.hoverOpacity)}}})),...Object.entries(e.palette).filter(W()).map(([s])=>({props:{color:s},style:{[`&.${T.checked}, &.${T.indeterminate}`]:{color:(e.vars||e).palette[s].main},[`&.${T.disabled}`]:{color:(e.vars||e).palette.action.disabled}}})),{props:{disableRipple:!1},style:{"&:hover":{"@media (hover: none)":{backgroundColor:"transparent"}}}}]}))),$e=r.jsx(we,{}),Pe=r.jsx(Ce,{}),Re=r.jsx(ve,{}),Me=f.forwardRef(function(s,o){const a=N({props:s,name:"MuiCheckbox"}),{checkedIcon:n=$e,color:t="primary",icon:l=Pe,indeterminate:i=!1,indeterminateIcon:c=Re,inputProps:d,size:x="medium",disableRipple:C=!1,className:B,...G}=a,F=i?c:l,w=i?c:n,v={...a,disableRipple:C,color:t,indeterminate:i,size:x},k=ye(v);return r.jsx(Se,{type:"checkbox",inputProps:{"data-indeterminate":i,...d},icon:f.cloneElement(F,{fontSize:F.props.fontSize??x}),checkedIcon:f.cloneElement(w,{fontSize:w.props.fontSize??x}),ownerState:v,ref:o,className:R(k.root,B),disableRipple:C,...G,classes:k})});function Be(e){return O("MuiFormControlLabel",e)}const g=D("MuiFormControlLabel",["root","labelPlacementStart","labelPlacementTop","labelPlacementBottom","disabled","label","error","required","asterisk"]),Fe=e=>{const{classes:s,disabled:o,labelPlacement:a,error:n,required:t}=e,l={root:["root",o&&"disabled",`labelPlacement${h(a)}`,n&&"error",t&&"required"],label:["label",o&&"disabled"],asterisk:["asterisk",n&&"error"]};return A(l,Be,s)},Le=M("label",{name:"MuiFormControlLabel",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:o}=e;return[{[`& .${g.label}`]:s.label},s.root,s[`labelPlacement${h(o.labelPlacement)}`]]}})(E(({theme:e})=>({display:"inline-flex",alignItems:"center",cursor:"pointer",verticalAlign:"middle",WebkitTapHighlightColor:"transparent",marginLeft:-11,marginRight:16,[`&.${g.disabled}`]:{cursor:"default"},[`& .${g.label}`]:{[`&.${g.disabled}`]:{color:(e.vars||e).palette.text.disabled}},variants:[{props:{labelPlacement:"start"},style:{flexDirection:"row-reverse",marginRight:-11}},{props:{labelPlacement:"top"},style:{flexDirection:"column-reverse"}},{props:{labelPlacement:"bottom"},style:{flexDirection:"column"}},{props:({labelPlacement:s})=>s==="start"||s==="top"||s==="bottom",style:{marginLeft:16}}]}))),ze=M("span",{name:"MuiFormControlLabel",slot:"Asterisk",overridesResolver:(e,s)=>s.asterisk})(E(({theme:e})=>({[`&.${g.error}`]:{color:(e.vars||e).palette.error.main}}))),Ie=f.forwardRef(function(s,o){const a=N({props:s,name:"MuiFormControlLabel"}),{checked:n,className:t,componentsProps:l={},control:i,disabled:c,disableTypography:d,inputRef:x,label:C,labelPlacement:B="end",name:G,onChange:F,required:w,slots:v={},slotProps:k={},value:Qe,...ee}=a,y=Y(),q=c??i.props.disabled??(y==null?void 0:y.disabled),L=w??i.props.required,H={disabled:q,required:L};["checked","name","onChange","value","inputRef"].forEach(P=>{typeof i.props[P]>"u"&&typeof a[P]<"u"&&(H[P]=a[P])});const se=Z({props:a,muiFormControl:y,states:["error"]}),S={...a,disabled:q,labelPlacement:B,required:L,error:se.error},z=Fe(S),oe={slots:v,slotProps:{...l,...k}},[re,$]=ue("typography",{elementType:b,externalForwardedProps:oe,ownerState:S});let u=C;return u!=null&&u.type!==b&&!d&&(u=r.jsx(re,{component:"span",...$,className:R(z.label,$==null?void 0:$.className),children:u})),r.jsxs(Le,{className:R(z.root,t),ownerState:S,ref:o,...ee,children:[f.cloneElement(i,H),L?r.jsxs("div",{children:[u,r.jsxs(ze,{ownerState:S,"aria-hidden":!0,className:z.asterisk,children:["â€‰","*"]})]}):u]})});function Te(e){return O("MuiFormGroup",e)}D("MuiFormGroup",["root","row","error"]);const Ue=e=>{const{classes:s,row:o,error:a}=e;return A({root:["root",o&&"row",a&&"error"]},Te,s)},De=M("div",{name:"MuiFormGroup",slot:"Root",overridesResolver:(e,s)=>{const{ownerState:o}=e;return[s.root,o.row&&s.row]}})({display:"flex",flexDirection:"column",flexWrap:"wrap",variants:[{props:{row:!0},style:{flexDirection:"row"}}]}),Oe=f.forwardRef(function(s,o){const a=N({props:s,name:"MuiFormGroup"}),{className:n,row:t=!1,...l}=a,i=Y(),c=Z({props:a,muiFormControl:i,states:["error"]}),d={...a,row:t,error:c.error},x=Ue(d);return r.jsx(De,{className:R(x.root,n),ownerState:d,ref:o,...l})}),Ee=({user:e,owner:s,column:o})=>r.jsxs(X,{sx:{p:2,borderRadius:2,display:"flex",flexDirection:o?"column":{xs:"column",sm:"row"},alignItems:o?"center":{xs:"center",sm:"start"},textAlign:o?"center":{xs:"center",sm:"start"}},children:[r.jsx(me,{width:80,height:80,to:`/dashboard/users/${e==null?void 0:e.username}`,src:`${ae}api/users/${e==null?void 0:e.username}/image`}),r.jsxs(fe,{sx:{width:"100%"},children:[r.jsxs(he,{sx:{display:"flex",flexDirection:o?"column":{xs:"column",sm:"row"}},children:[r.jsx(b,{variant:"h4",sx:{wordBreak:"break-word",flex:1,fontSize:{xs:15,sm:35}},children:e==null?void 0:e.name}),s&&r.jsx(Q,{variant:"text",children:"owner"})]}),r.jsx(J,{}),r.jsxs(b,{sx:{mt:2,wordBreak:"break-word"},children:["@",e==null?void 0:e.username]})]})]}),Ne=({room:e,user:s})=>{const[o,a]=p.useState([]),[n,t]=p.useState(null),[l,i]=p.useState(!1);p.useEffect(()=>{const d=new AbortController;return e&&s&&K(`api/rooms/${e==null?void 0:e.id}/logs/${s==null?void 0:s.username}`,a,t,i,!1,d),()=>{d.abort()}},[s,e]);const c=()=>{l||!n||K(n,a,t,i,!0)};return r.jsx(m,{sx:{width:"100%",maxWidth:600,border:"1px solid",borderColor:"divider"},children:r.jsx(xe,{messages:o,room:e,loadMessages:c,next:n})})},K=async(e,s,o,a,n,t)=>{a(!0);const l=await j(e,void 0,null,t);if(l.ok){const i=await l.json();s(n?c=>[...c,...i.data]:i.data),o(i.links.next),a(!1)}},Ae=({user:e,room:s,setUser:o,disabled:a})=>{const[n,t]=p.useState(!1),l=(i,c)=>{n||(c?He(i,s,e.username,o,t):Ve(i,s,e.username,o,t))};return r.jsxs(X,{sx:{width:"100%",p:1,mb:{xs:5,sm:5,md:0}},children:[r.jsx(b,{children:"Permissions: "}),r.jsx(Oe,{sx:{flexDirection:"row"},children:Ge.map(i=>r.jsx(Ie,{disabled:a||!e||e.isOwner,control:r.jsx(Me,{checked:qe(i.id,e),onChange:(c,d)=>l(i.id,d)}),label:i.name},i.id))})]})},Ge=[{id:1,name:"Write"},{id:2,name:"Manage room"},{id:3,name:"Manage members"},{id:4,name:"Manage permissions"},{id:5,name:"Manage messages"}],qe=(e,s)=>!!(s&&(s.isOwner||s.permissions.find(o=>o.id===e))),He=async(e,s,o,a,n)=>{n(!0);const t=await j(`api/rooms/${s==null?void 0:s.id}/users/${o}/permissions/${e}`,"POST");if(t.ok){const l=await t.json();a(i=>({...i,permissions:[...i.permissions,l.data]}))}n(!1)},Ve=async(e,s,o,a,n)=>{n(!0),(await j(`api/rooms/${s==null?void 0:s.id}/users/${o}/permissions/${e}`,"DELETE")).ok&&a(l=>{var i;return{...l,permissions:(i=l==null?void 0:l.permissions)==null?void 0:i.filter(c=>(c==null?void 0:c.id)!==e)}}),n(!1)},We=({user:e,room:s})=>{const o=ne(),[a,n]=p.useState(!1),t=()=>{a||(n(!0),_e(s,e,o))};return r.jsx(Q,{disabled:a,variant:"outlined",color:"error",onClick:t,children:"BAN"})},_e=async(e,s,o)=>{(await j(`api/rooms/${e.id}/bans/${s.username}`,"POST")).ok&&o(`/dashboard/rooms/${e.id}/settings/bans`,{replace:!0})},us=()=>{const{username:e}=ie(),[s,o]=p.useState(null),[a,n]=p.useState(null),t=_(le),l=_(ce);return p.useEffect(()=>{t!=null&&t.id&&Ke(t==null?void 0:t.id,e,o,n)},[e,t==null?void 0:t.id]),a?r.jsx(de,{status:a.status,errorText:a.errorText,to:"../",toText:"GO BACK"}):r.jsxs(ge,{children:[r.jsx(pe,{room:t}),r.jsx(J,{sx:{my:3}}),!s&&r.jsx(je,{color:"primary"}),r.jsxs(m,{children:[s&&r.jsxs(m,{sx:{display:"flex",flexDirection:{xs:"column",sm:"row"}},children:[r.jsx(m,{sx:{width:"100%",maxWidth:350},children:r.jsx(Ee,{user:s,owner:s==null?void 0:s.isOwner,column:!0})}),r.jsxs(m,{sx:{ml:{xs:0,sm:2},mt:{xs:2,sm:0}},children:[!I.manage_members(t,s)&&I.manage_members(t,l)&&r.jsx(m,{sx:{my:1},children:r.jsx(We,{room:t,user:s})}),r.jsx(Ae,{disabled:!I.manage_permissions(t,l),user:s,room:t,setUser:o})]})]}),s&&r.jsxs(m,{sx:{my:5},children:[r.jsx(b,{variant:"h4",children:"User log: "}),r.jsx(m,{sx:{display:"flex",overflow:"hidden",width:"100%",height:400,justifyContent:"center"},children:r.jsx(Ne,{room:t,user:s})})]})]})]})},Ke=async(e,s,o,a)=>{const n=await j(`api/rooms/${e}/users/${s}`);if(n.ok){const t=await n.json();o(t.data),a(null);return}a({status:n.status,errorText:n.statusText})};export{us as default};
